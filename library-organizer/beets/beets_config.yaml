# ============================================================================
# BEETS CONFIGURATION
# ============================================================================
# Minimal beets configuration for containerized environments
# The wrapper mounts your host config on /config.yaml
#
# Directory Structure:
#   /<AlbumArtist>/
#       <Artist> - (<Year>) <Album Title> [<Release Type>]/
#           (if multi-disc) Disc <N>/
#               <N>-<track_padded>. <Artist> - <Title>.<ext>
#           (if single-disc)
#               <track_padded>. <Artist> - <Title>.<ext>
# ============================================================================

# ----------------------------------------------------------------------------
# CORE SETTINGS
# ----------------------------------------------------------------------------
directory: /data
library: /data/library.db
threaded: yes
original_date: yes

# ----------------------------------------------------------------------------
# IMPORT SETTINGS
# ----------------------------------------------------------------------------
import:
  move: yes                 # Move files from import folder into library
  copy: no                  # Do not copy; only move
  write: yes                # Write metadata tags to files after importing
  singletons: no            # Do not treat single-track albums as standalone
  resume: yes               # Resume interrupted imports
  incremental: no           # Process everything, not just new files
  quiet: yes                # Non-interactive mode; no prompts
  autotag: yes              # Auto-fetch metadata from MusicBrainz
  duplicate_action: remove  # Remove old item before importing duplicate

# ----------------------------------------------------------------------------
# MATCHING SETTINGS
# ----------------------------------------------------------------------------
# Thresholds for matching candidate albums (0.0 = perfect, 1.0 = different)
# Lower thresholds = stricter matching; higher = more permissive
match:
  strong_rec_thresh: 0.30   # Auto-accept strong matches
  medium_rec_thresh: 0.50   # Medium matches (may need confirmation)

# ----------------------------------------------------------------------------
# PLUGINS
# ----------------------------------------------------------------------------
plugins:
  - inline        # Define custom item fields
  - albumtypes    # Detect and edit album types
  - musicbrainz   # Extract MusicBrainz metadata
  - scrub         # Clean up original metadata
  - fromfilename  # Parse metadata from filenames as fallback
  - lastgenre     # Guess genre from Last.fm tags
  - fetchart      # Download album cover art
  - embedart      # Embed cover art in audio files
  - lyrics        # Fetch song lyrics

# ----------------------------------------------------------------------------
# CUSTOM FIELDS
# ----------------------------------------------------------------------------
item_fields:
  disc_folder: f"Disc {disc:02d}" if disctotal > 1 else ""
  disc_and_track: f"{disc:02d}.{track:02d}" if disctotal > 1 else f"{track:02d}"

# ----------------------------------------------------------------------------
# ALBUM TYPES
# ----------------------------------------------------------------------------
albumtypes:
  types:
    - ep: 'EP'
    - single: 'Single'
    - soundtrack: 'OST'
    - live: 'Live'
    - compilation: 'Compilation'
    - remix: 'Remix'
  bracket: '[]'

# ----------------------------------------------------------------------------
# PATH FORMATS
# ----------------------------------------------------------------------------
paths:
  # Albums: <AlbumArtist>/<AlbumArtist> - [<Year>]<Types> <Album>/<Disc?>/<Track>. <Artist> - <Title>
  default: $albumartist/$albumartist - [$year]$atypes $album/$disc_folder/$disc_and_track. $artist - $title
  
  # Singles: Non-Album/<Artist>/<Title>
  singleton: Non-Album/$artist/$title
  
  # Compilations: Compilations/<Album>/<Track>. <Artist> - <Title>
  comp: Compilations/$album%aunique{}/$track. $artist -$title

# ----------------------------------------------------------------------------
# PERMITTED FILE EXTENSIONS
# ----------------------------------------------------------------------------
permitted_extensions:
  - mp3
  - m4a
  - aac
  - mp4
  - flac
  - wav
  - ogg

# ----------------------------------------------------------------------------
# MUSICBRAINZ SETTINGS
# ----------------------------------------------------------------------------
musicbrainz:
  extra_tags: [barcode, catalognum, country, label, media, year]
  external_ids:
    discogs: yes
    spotify: yes
    bandcamp: yes
    beatport: yes
    deezer: yes
    tidal: yes

# ----------------------------------------------------------------------------
# GENRE SETTINGS
# ----------------------------------------------------------------------------
lastgenre:
  force: yes                        # Force genre tagging
  keep_existing: no                 # Replace existing genres
  count: 5                          # Number of genres to fetch
  whitelist: /genres-whitelist.txt  # Custom genre whitelist
  canonical: /genres-tree.yaml      # Use tree for genre
  prefer_specific: yes              # Prefer specific over general genres
  min_weight: 0                     # Discard no genre

# ----------------------------------------------------------------------------
# ALBUM ART SETTINGS
# ----------------------------------------------------------------------------
art_filename: cover

fetchart:
  auto: yes                 # Fetch art automatically during import
  cautious: yes             # Prefer trusted filenames
  cover_names: front cover album folder art
  minwidth: 500             # Minimum image width (px)
  maxwidth: 1400            # Maximum image width (px)
  quality: 75               # JPEG compression quality (1-100)
  max_filesize: 1200000     # Max file size (~1.2 MB)
  enforce_ratio: 0.5%       # Accept approximately square images
  sources:
    - coverart: release     # Cover Art Archive by release ID
    - fanarttv
    - itunes
    - amazon
    - filesystem
  store_source: no          # Do not store art source tag
  high_resolution: no       # Disable extremely high-res images
  deinterlace: no           # Keep progressive JPEGs

# ----------------------------------------------------------------------------
# LYRICS SETTINGS
# ----------------------------------------------------------------------------
lyrics:
  sources: [lrclib,]        # You can set Genius as fallback but you get banned after many requests
  synced: yes               # Prefer synced/timestamped lyrics