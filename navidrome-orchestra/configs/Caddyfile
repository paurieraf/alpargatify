## Global options
{   
    # Admin accesible only in this virtual network
    admin caddy-admin:2019
    # Enable per-host metrics
    metrics {
        per_host
    }
}

## Add http:// as a prefix for each item for testing

# Navidrome
navidrome.<domain> {
    reverse_proxy navidrome:4533
}

# WUD
wud.<domain> {
    route {
        reverse_proxy wud:2999
    }
}

# Grafana
grafana.<domain> {
    route {
        reverse_proxy grafana:3000
    }
}

# Syncthing
syncthing.<domain> {
    route {
        reverse_proxy syncthing:8384
    }
}

# Internal monitoring endpoints - do NOT expose to the internet
# We respond with abort for public requests; Caddy will still proxy if the client is in allowed ranges (e.g., local network / your admin IP).
prometheus.<domain> {
    @allowed client_ip 127.0.0.1 192.168.1.0/24 10.0.0.0/8
    handle @allowed {
        reverse_proxy prometheus:9090
    }
    handle {
        abort
    }
}

cadvisor.<domain> {
    @allowed client_ip 127.0.0.1 192.168.1.0/24 10.0.0.0/8
    handle @allowed {
        reverse_proxy cadvisor:8080
    }
    handle {
        abort
    }
}
